---
import MainLayout from '../../layouts/MainLayout.astro';
import { getTeamsByCompetition } from '../../services/footballApiService';
import { COMPETITIONS } from '../../services/apiConfig';

// Obtener equipos de La Liga
let laLigaTeams = [];
let premierLeagueTeams = [];
let error = null;

try {
  // Cargar equipos de dos competiciones principales en paralelo
  const [laLigaResponse, premierResponse] = await Promise.all([
    getTeamsByCompetition(COMPETITIONS.LA_LIGA),
    getTeamsByCompetition(COMPETITIONS.PREMIER_LEAGUE)
  ]);
  
  laLigaTeams = laLigaResponse.teams || [];
  premierLeagueTeams = premierResponse.teams || [];
  
} catch (e) {
  console.error("Error al cargar los equipos:", e);
  error = "No se pudieron cargar los datos de equipos";
}

// Agrupa equipos por competición para mejor visualización
const competitions = [
  {
    id: COMPETITIONS.LA_LIGA,
    name: "LaLiga",
    teams: laLigaTeams
  },
  {
    id: COMPETITIONS.PREMIER_LEAGUE,
    name: "Premier League",
    teams: premierLeagueTeams
  }
];
---

<MainLayout title="Equipos | FútbolStats">
  <main>
    <section class="hero">
      <div class="container">
        <h1>Equipos</h1>
        <p>Explora todos los equipos y sus estadísticas</p>
      </div>
    </section>

    {error && <div class="error-banner">{error}</div>}
    
    <section class="teams-section">
      <div class="container">
        {competitions.map(competition => (
          <div class="competition-group">
            <h2 class="competition-title">{competition.name}</h2>
            
            {competition.teams.length === 0 ? (
              <p class="loading-message">Cargando equipos...</p>
            ) : (
              <div class="teams-grid">
                {competition.teams.map(team => (
                  <a href={`/equipos/${team.id}`} class="team-card">
                    <div class="team-logo">
                      <img 
                        src={team.crest} 
                        alt={team.name}
                        loading="lazy"
                        onerror="this.src='/assets/team-placeholder.png';"
                      />
                    </div>
                    <h3>{team.name}</h3>
                    <div class="team-info">
                      <span class="team-founded">{team.founded || "N/A"}</span>
                      <span class="team-country">{team.area?.name || "N/A"}</span>
                    </div>
                    <div class="team-view">Ver equipo</div>
                  </a>
                ))}
              </div>
            )}
          </div>
        ))}
      </div>
    </section>
  </main>
</MainLayout>

<style>
  .hero {
    background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
    color: white;
    padding: 3rem 0;
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  
  .hero h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }
  
  .competition-group {
    margin-bottom: 3rem;
  }
  
  .competition-title {
    font-size: 1.75rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 3px solid #f0f0f0;
  }
  
  .teams-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.5rem;
  }
  
  .team-card {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    padding: 1.5rem;
    text-align: center;
    text-decoration: none;
    color: inherit;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  
  .team-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  }
  
  .team-logo {
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
  }
  
  .team-logo img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }
  
  .team-card h3 {
    font-size: 1.1rem;
    margin-bottom: 0.75rem;
  }
  
  .team-info {
    display: flex;
    justify-content: center;
    gap: 1rem;
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 1rem;
  }
  
  .team-view {
    margin-top: auto;
    padding: 0.5rem;
    background-color: #f8f9fa;
    border-radius: 4px;
    font-size: 0.9rem;
    color: #495057;
    transition: background-color 0.2s;
  }
  
  .team-card:hover .team-view {
    background-color: #1a2a6c;
    color: white;
  }
  
  .error-banner {
    background-color: #f8d7da;
    color: #721c24;
    padding: 1rem;
    text-align: center;
    margin: 1rem 0;
    border-radius: 4px;
  }
  
  .loading-message {
    text-align: center;
    padding: 2rem;
    color: #6c757d;
  }
</style>